<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Cache Control Headers to prevent stale content -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <!-- Force refresh if cached version is older than 1 hour -->
    <meta http-equiv="refresh" content="3600" />
    
    <title>MusicSupplies.com</title>
    
    <!-- Preconnect to improve performance -->
    <link rel="preconnect" href="https://ekklokrukxmqlahtonnc.supabase.co" />
    <link rel="preconnect" href="https://mus86077.s3.amazonaws.com" crossorigin />
    
    <!-- Service Worker for advanced cache management -->
    <script>
      // Register service worker for cache management
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          // Unregister any existing service workers to force fresh content
          navigator.serviceWorker.getRegistrations().then(function(registrations) {
            for(let registration of registrations) {
              registration.unregister();
            }
          });
        });
      }
      
      // Force reload if page is loaded from cache
      window.addEventListener('pageshow', function(event) {
        if (event.persisted) {
          window.location.reload();
        }
      });
      
      // Add timestamp to prevent caching
      window.appVersion = Date.now();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Additional cache busting script -->
    <script>
      // Check for updates every 5 minutes
      setInterval(() => {
        fetch('/api/version-check', { 
          cache: 'no-cache',
          headers: {
            'Cache-Control': 'no-cache',
            'Pragma': 'no-cache'
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.version && window.appVersion && data.version !== window.appVersion) {
            // New version detected, show update notification
            if (confirm('A new version of the application is available. Would you like to refresh the page?')) {
              window.location.reload(true);
            }
          }
        })
        .catch(() => {
          // Silently fail if version check endpoint doesn't exist
        });
      }, 300000); // 5 minutes
    </script>
  </body>
</html>
